4. ADF-Concepts-SHIR-and-LinkedService-ConnectionSteps

## Overview
In this session, we demonstrate **how to set up a Self-Hosted Integration Runtime (SHIR) and Linked Services (SFTP & MySQL)** in Azure Data Factory (ADF).  
Scenario: **On-prem source → Azure Cloud destination**.  

We cover:
- Steps to create SHIR
- Creating Linked Services
- Common errors and troubleshooting
- Dos and Don’ts
- Real-time Q&A and interview-style answers

---

## 1️⃣ Self-Hosted Integration Runtime (SHIR)

**Purpose:**  
- SHIR is **compute installed on your local/on-prem machine** to move data to Azure securely.  
- Required when sources are inside **enterprise/private networks**.  
- Provides flexibility to open ports to multiple sources.  

**Who installs SHIR?**  
- Typically **Infra/DevOps Team**, because they manage networking, firewall, and ports.  
- Developers only use SHIR to create Linked Services and pipelines.

### Steps to Install SHIR

1. Go to **ADF Studio → Manage → Integration Runtime → New**  
2. Choose **Self-Hosted** IR (not Azure IR)  
   - Azure IR is cloud-managed; lacks flexibility for on-prem sources.  
3. Give a name according to naming convention, e.g.:  IR_FMCG
4. Choose **installation method**:  
- **Express Setup** → Auto-install on local PC.  
- **Manual Setup** → Required for remote PCs; copy setup file and key manually.  
5. Complete installation → SHIR should be in **Running Mode**.  

**Notes:**  
- SHIR compute runs **locally**.  
- Must be installed **before creating Linked Services**.

---

## 2️⃣ Linked Services in ADF

**Purpose:**  
- Linked Services define **connections to source/destination data stores**.  
- Required for pipelines to know **where to read/write data**.

**Real-Time Scenario:**  
- Source: **SFTP on local PC**  
- Source: **MySQL on local PC**  
- Destination: **Azure Data Lake/Cloud**  
- SHIR: **Local PC acting as compute**

---

### 2.1 Creating SFTP Linked Service

**Steps:**

1. **Navigate:** ADF Studio → Manage → Linked Services → New → SFTP  
2. **Name the Linked Service:**

LS_SFTP
3. **Connect via IR:** `IR_FMCG` (Self-Hosted)  
4. **Enter IP Address:** Use `ipconfig → IPv4 Address`  
- Not Wi-Fi IP  
5. **SSH Key Validation:** Disable for local testing  
6. **Authentication:**  
- Username/Password of **local PC login**  
- If using Microsoft Account → use email & password  
- For VM → use VM credentials  
7. **Test Connection** → If failed, likely **ports not open**

**Common Errors & Troubleshooting:**

- **Authentication Failed**
- SHIR not running
- Port 22 (SSH) closed
- Wrong username/password
- **Fix Steps:**
1. Install **OpenSSH Server** (Optional Features → Add OpenSSH Server)  
2. Open port 22 in **Windows Defender Firewall → Inbound Rule → Allow All**  
3. Start SSH service and set **Automatic**  
4. Retry **Test Connection**  

**Dos & Don’ts:**

- ✅ DO use local PC credentials for demo/testing  
- ✅ DO ensure SHIR is running  
- ✅ DO open port 22 in firewall  
- ❌ DON’T use Wi-Fi IP  
- ❌ DON’T skip SSH setup  

---

### 2.2 Creating MySQL Linked Service

**Steps:**

1. ADF Studio → Manage → Linked Services → New → MySQL  
2. Name the linked service: LS_MySQL
3. Connect via **IR_FMCG**  
4. Server Name: `localhost` (if MySQL is local)  
5. Database Name: Use **actual database**, e.g., `FMCG`  
6. Authentication: **MySQL credentials**, NOT Windows login  
7. Test Connection → Ensure MySQL service is running  

**Dos & Don’ts:**

- ✅ DO start MySQL service  
- ✅ DO use correct database & credentials  
- ❌ DON’T use Windows login credentials  

---

## 3️⃣ Questions & Answers (Real-time / Interview Style)

| Question | Short Answer |
|----------|--------------|
| Who installs SHIR? | Infra/DevOps Team usually. |
| Who creates Linked Services? | Developers can create; Infra ensures ports are open. |
| Why SHIR? | To securely connect on-prem/private network sources to ADF. |
| Error: Authentication failed | Ports not open, SHIR not running, or wrong credentials. |
| Authentication type? | Basic for demo/local; Public Key if using VM/RSA/MFA. |
| Are Linked Services environment-specific? | Yes, create in Dev, Test, Prod separately. |
| Can SHIR be shared? | Yes, multiple Linked Services can use same SHIR. |

---

## 4️⃣ Troubleshooting Checklist

1. **Connection failed**
- Check SHIR is running  
- Check firewall/port 22 open  
- Check username/password
2. **SFTP/VM authentication**
- Use correct local or VM credentials  
- If MFA, use **Public Key Authentication**
3. **Ports**
- Optional Features → Install OpenSSH Server  
- Windows Firewall → Inbound Rule → Port 22 → Allow All → Apply
4. **Service Start**
- SSH service → set **Automatic** → Start  

---

## 5️⃣ Real-Time Practical Notes

- **Order:** SHIR → Linked Service → Dataset → Pipeline  
- Local testing simulates **on-premise environment**  
- Infra/DevOps will handle **ports, firewalls, remote setups** in enterprise  
- Linked Services can be **reused for multiple pipelines**  
- Always **Test Connection** before moving data  

---

## 6️⃣ Key Takeaways

- SHIR = **on-prem compute for ADF**  
- Linked Service = **connection object**  
- Authentication differs: **local PC, VM, enterprise SFTP**  
- Firewall & SSH setup is **critical for connectivity**  
- Linked Services must be **environment-specific**  
- Understanding these steps is critical for **interviews and real-time projects**

---

## 7️⃣ End Notes

This Markdown file consolidates:

- SHIR setup  
- Linked Service creation (SFTP & MySQL)  
- Real-time errors and troubleshooting  
- Dos/Don’ts  
- Interview-style questions & concise answers  

> Use this as a **reference for practice, real-time implementation, and interviews**.


